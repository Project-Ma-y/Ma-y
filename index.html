<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Firebase 로그인 테스트</title>
</head>

<body>
    <h2>Firebase 로그인</h2>

    <form id="loginForm">
        <label>이메일: <input type="email" id="email" required /></label><br><br>
        <label>비밀번호: <input type="password" id="password" required /></label><br><br>
        <button type="submit">로그인</button>
    </form>

    <h3>응답:</h3>
    <pre id="output"></pre>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALislKfX7MQeh1IteqWiiaxYGJ_KrNZN4",
            authDomain: "ma-y-b1fa6.firebaseapp.com",
            databaseURL: "https://ma-y-b1fa6-default-rtdb.firebaseio.com",
            projectId: "ma-y-b1fa6",
            storageBucket: "ma-y-b1fa6.firebasestorage.app",
            messagingSenderId: "48645617538",
            appId: "1:48645617538:web:23d556cdd2c5b223b2019b",
            measurementId: "G-8CPE7B7PLN",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const form = document.getElementById("loginForm");
        const output = document.getElementById("output");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const token = await auth.currentUser.getIdToken();
                const uid = userCredential.user.uid;

                // ✅ 토큰과 uid 로컬 스토리지에 저장
                localStorage.setItem("idToken", token);
                localStorage.setItem("uid", uid);


                // API 서버로 전송 (선택사항)
                // const response = await fetch("https://ma-y-5usy.onrender.com/api/users/auth", {
                //     method: "GET",
                //     headers: {
                //         "Authorization": `Bearer ${token}`
                //     }
                // });


                //로컬 서버로 전송
                const response = await fetch("http://127.0.0.1:3000/api/users/auth", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`
                    }
                });


                if (!response.ok) {
                    const errText = await response.text();
                    throw new Error(`서버 응답 오류: ${errText}`);
                }

                const result = await response.json();

                output.textContent = `✅ 로그인 성공\n\nUID: ${uid}\n\nID Token:\n${token}\n\n서버 응답:\n${JSON.stringify(result, null, 2)}`;
            } catch (error) {
                output.textContent = `❌ 로그인 실패\n${error.message}`;
            }
        });
    </script>
</body>

</html>