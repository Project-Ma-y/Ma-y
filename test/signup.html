<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>회원가입 테스트 (POST /auth/signupEmail)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif; }
    body { margin: 0; padding: 24px; background: #f7f7f9; }
    h1 { margin: 0 0 16px; font-size: 20px; }
    h2 { margin: 0 0 12px; font-size: 16px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .row { display: grid; grid-template-columns: 170px 1fr; gap: 12px; align-items: center; margin-bottom: 10px; }
    .row label { font-weight: 600; }
    input[type="text"], input[type="password"], input[type="tel"], input[type="date"], input[type="url"], textarea, select { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: #fff; }
    .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    button { padding: 10px 14px; border: 1px solid #d1d5db; border-radius: 10px; background: #111827; color: #fff; cursor: pointer; font-weight: 600; }
    button.secondary { background: #fff; color: #111827; }
    .muted { color: #6b7280; font-size: 12px; }
    .ok { color: #065f46; }
    .warn { color: #92400e; }
    .err { color: #991b1b; }
    pre { background: #0b1020; color: #e5e7eb; padding: 12px; border-radius: 10px; overflow: auto; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  </style>
</head>
<body>
  <h1>회원가입 테스트 <span class="muted">POST /auth/signupEmail</span></h1>

  <!-- 공통 설정 -->
  <div class="card">
    <h2>공통</h2>
    <div class="row">
      <label for="base">API Endpoint</label>
      <input id="base" type="url" placeholder="https://ma-y-5usy.onrender.com/api/auth/signupEmail" />
    </div>
    <div class="muted">라우터가 <code>router.post("/signupEmail", ...)</code> 이고 상위가 <code>/api/auth</code> 라우터라면 최종 경로는 <code>/api/auth/signupEmail</code> 입니다.</div>
  </div>

  <!-- 회원가입 본문 -->
  <div class="card">
    <h2>회원정보</h2>
    <div class="row"><label>customerType</label>
      <select id="customerType">
        <option value="family">family</option>
        <option value="senior">senior</option>
      </select>
    </div>
    <div class="row"><label>id</label><input id="id" type="text" placeholder="로그인 ID (이메일 앞부분)" /></div>
    <div class="grid2">
      <div class="row"><label>password</label><input id="password" type="password" placeholder="비밀번호" /></div>
      <div class="row"><label>pwVerify</label><input id="pwVerify" type="password" placeholder="비밀번호 확인" /></div>
    </div>
    <div class="row"><label>name</label><input id="name" type="text" placeholder="홍길동" /></div>
    <div class="row"><label>phone</label><input id="phone" type="tel" placeholder="01012345678" /></div>
    <div class="row"><label>gender</label>
      <select id="gender">
        <option value="male">male</option>
        <option value="female">female</option>
        <option value="other">other</option>
      </select>
    </div>
    <div class="row"><label>address</label><input id="address" type="text" placeholder="서울시 …" /></div>
    <div class="row"><label>birthdate</label><input id="birthdate" type="date" /></div>

    <div class="actions" style="margin-top:10px">
      <button id="sendRegister">회원가입 요청</button>
      <button id="fillExample" class="secondary">예시 입력</button>
    </div>
  </div>

  <!-- 로그 -->
  <div class="card">
    <div class="row"><label>요청 미리보기</label><div id="reqPreview" class="muted"></div></div>
    <pre id="outReq"><code></code></pre>
  </div>
  <div class="card">
    <div class="row"><label>응답</label><div id="status" class="muted"></div></div>
    <pre id="out"><code></code></pre>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);

    (function setDefaults(){
      const guesses = [
        'https://ma-y-5usy.onrender.com/api/auth/signupEmail',
        'http://localhost:3000/api/auth/signupEmail',
        'http://127.0.0.1:3000/api/auth/signupEmail'
      ];
      $('#base').value = guesses[0];
    })();

    function buildBody(){
      return {
        customerType: $('#customerType').value,
        id: $('#id').value.trim(),
        password: $('#password').value,
        pwVerify: $('#pwVerify').value,
        name: $('#name').value.trim(),
        phone: $('#phone').value.trim(),
        gender: $('#gender').value,
        address: $('#address').value.trim(),
        birthdate: $('#birthdate').value, // YYYY-MM-DD
      };
    }

    function preview(url, headers, body){
      $('#reqPreview').textContent = `POST ${url}`;
      $('#outReq').textContent = JSON.stringify({ method: 'POST', url, headers, body }, null, 2);
    }

    async function doFetch(url, options){
      $('#status').textContent = '요청 중…';
      $('#out').textContent = '';
      try{
        const resp = await fetch(url, options);
        const text = await resp.text();
        let parsed; try { parsed = JSON.parse(text); } catch (_) { parsed = { raw: text }; }
        $('#status').innerHTML = `HTTP <strong>${resp.status}</strong> ${resp.ok ? '<span class="ok">OK</span>' : '<span class="err">ERROR</span>'}`;
        const usefulHeaders = {}; resp.headers.forEach((v,k)=>{ if(['set-cookie','content-type','x-request-id'].includes(k) || k.startsWith('x-')) usefulHeaders[k]=v; });
        $('#out').textContent = JSON.stringify({ status: resp.status, ok: resp.ok, headers: usefulHeaders, data: parsed }, null, 2);
      }catch(e){
        $('#status').innerHTML = '<span class="err">네트워크 에러</span>';
        $('#out').textContent = String(e);
      }
    }

    // 예시 채우기
    $('#fillExample').addEventListener('click', () => {
      $('#customerType').value = 'family';
      $('#id').value = 'testuser01';
      $('#password').value = 'Passw0rd!';
      $('#pwVerify').value = 'Passw0rd!';
      $('#name').value = '홍길동';
      $('#phone').value = '01012345678';
      $('#gender').value = 'male';
      $('#address').value = '서울특별시 중구 을지로 12';
      $('#birthdate').value = '1980-05-15';
    });

    // 전송
    $('#sendRegister').addEventListener('click', async () => {
      const url = $('#base').value.trim();
      if (!url) return alert('API Endpoint를 입력하세요.');

      const body = buildBody();
      // 최소 검증
      if (!body.id || !body.password || !body.pwVerify || !body.name) {
        return alert('id / password / pwVerify / name 은 필수입니다.');
      }

      const headers = { 'Content-Type': 'application/json' };
      preview(url, headers, body);

      await doFetch(url, {
        method: 'POST',
        mode: 'cors',
        credentials: 'include', // 세션 쿠키를 사용하는 라우터이므로 포함
        headers,
        body: JSON.stringify(body),
      });
    });
  </script>
</body>
</html>
